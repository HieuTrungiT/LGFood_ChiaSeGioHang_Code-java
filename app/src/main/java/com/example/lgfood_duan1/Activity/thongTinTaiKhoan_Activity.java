package com.example.lgfood_duan1.Activity;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import androidx.constraintlayout.widget.ConstraintLayout;import android.content.Intent;import android.net.Uri;import android.os.Bundle;import android.view.View;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import com.example.lgfood_duan1.Model.model_Account;import com.example.lgfood_duan1.Model.model_SanPham;import com.example.lgfood_duan1.R;import com.google.android.gms.tasks.OnFailureListener;import com.google.android.gms.tasks.OnSuccessListener;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import com.google.firebase.storage.FirebaseStorage;import com.google.firebase.storage.StorageReference;import com.google.firebase.storage.UploadTask;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Date;import java.util.UUID;import de.hdodenhof.circleimageview.CircleImageView;public class thongTinTaiKhoan_Activity extends AppCompatActivity {    private TextView            ThongTinTaiKhoan_tv_tenTaiKhoan;    private ImageView            ThongTinTaiKhoan_img_btn_thoat,            ThongTinTaiKhoan_img_btn_chonAnh,            ThongTinTaiKhoan_img_btn_showThongTinTaiKhoan,            ThongTinTaiKhoan_img_btn_showThongKe,            ThongTinTaiKhoan_img_btn_showCaiDat;    private ConstraintLayout            ThongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan,            ThongTinTaiKhoan_ctlou_btn_showThongKe,            ThongTinTaiKhoan_ctlou_btn_showCaiDat;    private de.hdodenhof.circleimageview.CircleImageView            ThongTinTaiKhoan_Crimg_avatar;    private FirebaseDatabase database;    private DatabaseReference myRef;    private FirebaseStorage storage;    private UploadTask uploadTask;    private StorageReference mountainImagesRef, storageRef;    private UUID uuid;    private model_Account listAccount;    private ArrayList<model_Account> arrListAccount;    private static final int REQUEST_IMAGE_OPEN = 99;    Uri full;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_thong_tin_tai_khoan);        anhXa();        batSuKien();        uuid = UUID.randomUUID();        storageRef = storage.getReference();        mountainImagesRef = storageRef.child("images/Account/" + new Date().getTime() + ".jpg");        uploadTask = mountainImagesRef.putFile(full);        //  kiếm tra        //  nếu lỗi file chạy vào đây        uploadTask.addOnFailureListener(new OnFailureListener() {            @Override            public void onFailure(Exception e) {                Toast.makeText(thongTinTaiKhoan_Activity.this, "Lưu ảnh thất bại", Toast.LENGTH_SHORT).show();            }            //     add file thành công        }).addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {            @Override            public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {                //    khởi tạo link url                mountainImagesRef.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {                    @Override                    public void onSuccess(Uri uri) {//                        //      myRef chỉ con trỏ tại vị trí ""                        myRef = database.getReference("Account");////                        //      kiểm tra điều kiện nếu như có ảnh trên storage thì lưu có định dạng không thì rỗng                        listAccount = new model_Account(uuid.toString(),listAccount.getName(), listAccount.getPassword(), listAccount.getAddress(), listAccount.getEmail(), listAccount.getPhoneNumber(), listAccount.getIdGioHang(), listAccount.getAnhKhachHang());                        myRef.child("Accounts").child("anhKhachHang").setValue("");////                        //        add giá trị                        myRef.child(listAccount.getId().toString()).setValue(listAccount);                        Toast.makeText(thongTinTaiKhoan_Activity.this, "Thêm thành công", Toast.LENGTH_SHORT).show();                    }                });            }        });    }    private void batSuKien() {//        chuyển sang trang đăng kí tài khoản        ThongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(thongTinTaiKhoan_Activity.this, Chinh_Sua_Thong_Tin_Accounts_Activity.class);                startActivity(intent);            }        });    }    // Trung: mở thư viện ảnh    private void moFileThuMucAnh() {        anhXa();        Intent intent = new Intent(Intent.ACTION_GET_CONTENT);        intent.setType("image/*");        intent.addCategory(Intent.CATEGORY_OPENABLE);        startActivityForResult(intent, REQUEST_IMAGE_OPEN);    }    // lấy ảnh trong thư viện và show anh lên imgview    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data) {        //  bắt sự kiến khi nhấn lưu ảnh thỉ gán vào imgview        if (requestCode == REQUEST_IMAGE_OPEN && resultCode == RESULT_OK && data != null && data.getData() != null) {            full = data.getData();            ThongTinTaiKhoan_img_btn_chonAnh.setImageURI(full);            ThongTinTaiKhoan_img_btn_chonAnh.setVisibility(View.VISIBLE);        }        super.onActivityResult(requestCode, resultCode, data);    }    private void anhXa() {        //    Firebase        database = FirebaseDatabase.getInstance("https://duan1-lgfood-default-rtdb.asia-southeast1.firebasedatabase.app/");        //    FirebaseStorage        storage = FirebaseStorage.getInstance("gs://duan1-lgfood.appspot.com");//    CircleImageView        ThongTinTaiKhoan_Crimg_avatar = findViewById(R.id.thongTinTaiKhoan_Crimg_avatar);//    TextView        ThongTinTaiKhoan_tv_tenTaiKhoan = findViewById(R.id.thongTinTaiKhoan_tv_tenTaiKhoan);//    ImageView        ThongTinTaiKhoan_img_btn_thoat = findViewById(R.id.thongTinTaiKhoan_img_btn_thoat);        ThongTinTaiKhoan_img_btn_chonAnh = findViewById(R.id.thongTinTaiKhoan_img_btn_chonAnh);        ThongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan = findViewById(R.id.thongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan);        ThongTinTaiKhoan_ctlou_btn_showThongKe = findViewById(R.id.thongTinTaiKhoan_ctlou_btn_showThongKe);        ThongTinTaiKhoan_ctlou_btn_showCaiDat = findViewById(R.id.thongTinTaiKhoan_ctlou_btn_showCaiDat);//        ConstraintLayout        ThongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan = findViewById(R.id.thongTinTaiKhoan_ctlou_btn_showThongTinTaiKhoan);    }}